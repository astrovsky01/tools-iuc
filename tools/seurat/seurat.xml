<tool id="seurat" name="Seurat" version="2.3.4">
    <description>- toolkit for exploration of single-cell RNA-seq data</description>
    <requirements>
        <requirement type="package" version="3.6.1">r-base</requirement>
        <requirement type="package" version="2.3.4">r-seurat</requirement>
        <requirement type="package" version="1.0.0">bioconductor-singlecellexperiment</requirement>
        <requirement type="package" version="1.6.0">r-optparse</requirement>
        <requirement type="package" version="1.16">r-rmarkdown</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript -e "rmarkdown::render(\"~/Desktop/galaxy/tools/mytools/seurat/Seurat.R\", params = list(counts = \"~/Downloads/deng_small.tab.gz\", min_cells = \"3\", min_genes = \"200\", low_thresholds = \"1\", high_thresholds = \"20000000\", numPCs = \"10\", cells_use=\"500\", resolution = \"0.6\", min_pct = \"0.25\", logfc_threshold = \"0.25\", warn = \"F\", varstate = \"T\", showcode=\"T\"), output_format=\"pdf_document\", output_file=\"out.pdf\")"
]]></command>

    <inputs>
        <param name="counts" type="data" format="tabular" label="Counts file" help="The should be a TAB-separated count matrix with gene identifers in the first column and a header row"/>
        <section name="adv" title="Advanced Options">
            <param name="num_PCs" type="integer" min="0" value="10" label="Number of PCs to use in plots" help="Uses this number of PCs in PCHEatmap, JackStrawPlot, FindClusters, RunTSNE. Default: 10" />
            <param name="min_cells" type="integer" min="0" value="0" label="Minimum cells" help="Include genes with detected expression in at least this many cells." />
            <param name="min_genes" type="integer" min="0"  value="0" label="Minimum genes" help="Include cells where at least this many genes are detected." />
            <param name="low_thresholds" type="float" optional="True" label="Low threshold for filtering cells" />
            <param name="high_thresholds" type="float" optional="True" label="High threshold for filtering cells" />
            <param name="cells_use" type="integer" min="0" optional="True" label="Cells to use for PCHeatmap" help="Plots this number of top ‘extreme’ cells on both ends of the spectrum, which dramatically speeds plotting for large datasets" />
            <param name="resolution" type="float" optional="True" label="Resolution parameter" help="Value of the resolution parameter used in FindClusters, use a value above (below) 1.0 if you want to obtain a larger (smaller) number of communities." />
            <param name="min_pct" type="float" optional="True" label="Minimum percent cells" help="With FindMarkers only test genes that are detected in a minimum fraction of min.pct cells in either of the two populations. Meant to speed up the function by not testing genes that are very infrequently expressed. Default is 0.1" />
            <param name="logfc_threshold" type="float" min="0" optional="True" label="LogFC threshold"
                help="With FindMarkers, limit testing to genes which show, on average, at least X-fold difference (log-scale)between the two groups of cells. Default is 0.25 Increasing logfc.threshold speeds up the function, but can miss weaker signals." />
        </section>
        <section name="meta" title="Output options" expanded="true">
            <param name="showcode" type="boolean" truevalue="T" falsevalue="F" checked="false" label="Show code alongside outputs?"/>
            <param name="warn" type="boolean" truevalue="T" falsevalue="F" checked="false" label="Include warnings in the output pdf (Yes) or pipe to stdout (No)"/>
            <param name="varstate" type="boolean" truevalue="T" falsevalue="F" checked="false" label='Display variable values used in code at the beginning of output PDF?'/>
        </section>
    </inputs>

    <outputs>
        <data name="out_pdf" format="pdf" from_work_dir="out.pdf" label="${tool.name} on ${on_string}: Plots" />
    </outputs>

    <tests>
        <!-- Ensure count matrix input works -->
        <test>
            <param name="counts" ftype="tabular" value="deng_small.tab.gz"/>
            <param name="min_cells" value="3"/>
            <param name="min_genes" value="200"/>
            <param name="low_thresholds" value="1" />
            <param name="high_thresholds" value="20000000" />
            <param name="numPCs" value="10" />
            <param name="cells_use" value="500"/>
            <param name="resolution" value="0.6" />
            <param name="min_pct" value="0.25" />
            <param name="logfc_threshold" value="0.25" />
            <output name="out_pdf" ftype="pdf" value="out.pdf" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

Seurat_ is a toolkit for quality control, analysis, and exploration of single cell RNA sequencing data.
It is developed and maintained by the `Satija Lab`_ at NYGC. Seurat aims to enable users to identify and
interpret sources of heterogeneity from single cell transcriptomic measurements, and to integrate diverse
types of single cell data. See the `Seurat Guided Clustering tutorial`_ for more information.

-----

**Inputs**

    * Gene count matrix in TAB-separated format

-----

**Outputs**

    * PDF of plots

Optionally you can choose to output

    * Seurat RDS object (can use within R)
    * Rscript

.. _Seurat: https://www.nature.com/articles/nbt.4096
.. _Satija Lab: https://satijalab.org/seurat/
.. _Seurat Guided Clustering tutorial: https://satijalab.org/seurat/pbmc3k_tutorial.html

]]></help>
    <citations>
        <citation type="doi">10.1038/nbt.4096</citation>
    </citations>
</tool>

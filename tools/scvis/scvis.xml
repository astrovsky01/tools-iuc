<tool id="scvis_train" name="SCVIS train" version="0.1.0">
    <description>Parametric alternative to t-SNE for use in high-dimensional data analysis.</description>
    <requirements>
        <requirement type="package" version="0.1.0">scvis</requirement>
        <requirement type="package">tensorflow</requirement>
    </requirements>
    <command detect_errors="aggressive"><![CDATA[
scvis train --data_matrix_file '${datafile}'
  #if $labels.label == 'Yes':
      --data_label_file '${datalabel}'
  #end if
  #if $config.choice == "Yes":
      --config_file '${configfile}'
  #end if
  #if $norm.normalize == "Yes":
      --normalize your_number '${normval}'
  #end if
  --show_plot
  --verbose &&
  mv *./output/* ./output
    ]]></command>
    <inputs>
        <param name="datafile" type="data" format="tsv" label="Data Matrix File" help="Data matrix with first row as the column names"/>
            <conditional name="labels">
                <param name="label" type="select" label="Provide clustering information" help="Give cluster information for graph coloring?">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </param>
                <when value="No"/>
                <when value="Yes">
                    <param name="datalabel" type="data" format="tsv" label="Data Label File" help="Optional: One column file with header provinding corresponding cluster information for each data point. Used for coloring plots."/>
                </when>
            </conditional>
            <conditional name="config">
                <param name="choice" type="select" label="Provide config file">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </param>
                <when value="No"/>
                <when value="Yes">
                    <param name="configfile" type="data" format="yaml" optional="true" label="Config File" help="Optional: Config yaml file as specified in the scvis docs"/>
                </when>
            </conditional>
            <conditional name="norm">
                <param name="normalize" type="select" label="Set Normalization Value?" help="If not selected, normalization will use maximum absolute value">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </param>
                <when value="No"/>
                <when value="Yes">
                     <param name="normval" type="float" label="Normalization value" help="A positive float" value="0.5"/>
                </when>
            </conditional>
    </inputs>
    <outputs>
      <collection name="trainging_graphs" type="list" label="Training graphical outputs">
          <discover_datasets pattern="0.png" directory="output"/>
      </collection>
      <collection name="final_graphs" type="list" label="Final graphical outputs">
          <discover_datasets pattern="perplexity*.png" directory="output"/>
      </collection>
      <collection name="final_numeric" type="list" label="Final numeric outputs">
          <discover_datasets pattern="perplexity*.tsv" directory="output"/>
      </collection>
      <collection name="model" type="list" label="model">
          <discover_datasets pattern="*.ckpt" directory="output"/>
      </collection>
      <data name="checkpoint"/>
    </outputs>
    <stdio>
        <exit_code range = "1" level="warning" description="tensorflow interpreter problem" />
    </stdio>
    <citations>
        <citation type="doi">10.1038/s41467-018-04368-5</citation>
    </citations>
    <help><![CDATA[
This tool is for the initial training of the model and clustering graphs. To add data to your model, use SCVIS map.
    ]]></help>
</tool>
